- pipeline: test
  name: Test
  refs:
  - refs/heads/main
  events:
  - type: PUSH
  fail_on_prepare_env_warning: true
  resources: SMALL
  actions:
  - action: Execute command
    type: NATIVE_BUILD_MAC
    commands:
    - "# Example"
    - "# xcodebuild -resolvePackageDependencies -workspace <your_workspace_name> -scheme <your_scheme_name>"
    - ""
    - "# 1. CocoaPods 설치 및 업데이트 (필요한 경우)"
    - echo "Installing CocoaPods..."
    - "# 'platforms/ios' 폴더로 이동합니다."
    - cd platforms/ios
    - ""
    - "# CocoaPods를 설치하거나 업데이트합니다."
    - pod install
    - ""
    - "# 다시 프로젝트 루트로 돌아옵니다."
    - cd ../..
    - ""
    - "# 2. Cordova iOS 릴리스 버전 빌드"
    - "# 앱스토어 배포를 위한 릴리스 버전으로 빌드합니다."
    - echo "Running Cordova build for iOS release..."
    - cordova build ios --release
    - ""
    - "# 3. 빌드된 IPA 파일을 아티팩트로 저장"
    - "# 빌드된 .ipa 파일은 'platforms/ios/build/device/'에 생성됩니다."
    - "# Buddy가 아티팩트를 찾을 수 있도록 별도 폴더에 복사합니다."
    - echo "Publishing artifacts..."
    - mkdir -p buddy_artifacts
    - cp platforms/ios/build/device/*.ipa buddy_artifacts/
    shell: BASH
    sync_paths:
    - pipeline_path: /
      vm_path: /Users/buddy/build
      direction: PIPELINE_TO_VM
      excludes: ""
      includes: ""
    - pipeline_path: /.buddy/
      vm_path: /Users/buddy/build
      direction: VM_TO_PIPELINE
      excludes: ""
      includes: ""
    pre_start_simulators:
    - iPhone SE (3rd generation)
    xcode_version: 15.4.0
