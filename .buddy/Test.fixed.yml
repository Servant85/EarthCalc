- pipeline: test
  name: Test
  refs:
  - refs/heads/main
  events:
  - type: PUSH
  fail_on_prepare_env_warning: true
  resources: SMALL
  actions:
  - action: Execute command
    type: NATIVE_BUILD_MAC
    commands:
    - "# Example"
    - "# xcodebuild -resolvePackageDependencies -workspace <your_workspace_name> -scheme <your_scheme_name>"
    shell: BASH
    pre_start_simulators:
    - iPhone SE (3rd generation)
    xcode_version: 15.4.0
  - action: '  -exportOptionsPlist ExportOptions.plist'
    type: BUILD
    docker_image_name: buddy/localshell
    docker_image_tag: ubuntu_24.04
    execute_commands:
    - xcodebuild \
    - '  -workspace MyApp.xcworkspace \'
    - '  -scheme MyApp \'
    - '  -sdk iphoneos \'
    - '  -configuration Release \'
    - '  archive -archivePath build/MyApp.xcarchive'
    - ""
    - xcodebuild \
    - '  -exportArchive \'
    - '  -archivePath build/MyApp.xcarchive \'
    - '  -exportPath build/ios \'
    - '  -exportOptionsPlist ExportOptions.plist'
    shell: BASH
