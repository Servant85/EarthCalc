- pipeline: test
  name: Test
  refs:
  - refs/heads/main
  events:
  - type: PUSH
  fail_on_prepare_env_warning: true
  resources: SMALL
  actions:
  - action: Execute command
    type: NATIVE_BUILD_MAC
    commands:
    - "# Example"
    - "# xcodebuild -resolvePackageDependencies -workspace <your_workspace_name> -scheme <your_scheme_name>"
    shell: BASH
    pre_start_simulators:
    - iPhone SE (3rd generation)
    xcode_version: 15.4.0
  - action: "docker buildx build --cache-to=\"type=gha,mode=max\" --cache-from=\"type=gha\" --builder=buildx-builder ."
    type: NATIVE_BUILD_DOCKER_CLI
    commands:
    - docker context create docker-context
    - docker buildx create --name buildx-builder --use docker-context --bootstrap --driver=docker-container
    - "docker buildx build --cache-to=\"type=gha,mode=max\" --cache-from=\"type=gha\" --builder=buildx-builder ."
    instance_type: GENERAL_MEDIUM
